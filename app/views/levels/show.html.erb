<div class="h-screen flex flex-col" data-controller="live-preview">
  <!-- Header -->
  <header class="bg-gray-800 text-white p-4 flex justify-between items-center shrink-0">
    <div class="flex items-center space-x-4">
      <%= link_to t('levels.show.home'), levels_path, class: "text-gray-300 hover:text-white" %>
      <h1 class="text-xl font-bold"><%= t('levels.show.level') %> <%= @level.number %>: <%= @level.title %></h1>
    </div>
    <div class="flex space-x-2">
      <% if @prev_level %>
        <%= link_to t('levels.show.previous'), level_path(@prev_level), class: "px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded" %>
      <% end %>
      <% if @next_level %>
        <%= link_to t('levels.show.next'), level_path(@next_level), class: "px-3 py-1 bg-blue-600 hover:bg-blue-500 rounded" %>
      <% end %>
    </div>
  </header>

  <!-- Main Content -->
  <div class="flex-1 flex overflow-hidden">
    <!-- Left Panel: Instructions & Editor -->
    <div class="w-1/2 flex flex-col border-r border-gray-300">
      <!-- Instructions -->
      <div class="p-6 bg-gray-50 border-b border-gray-200 overflow-y-auto h-1/3">
        <h2 class="text-lg font-semibold mb-2"><%= t('levels.show.instructions') %></h2>
        <p class="text-gray-700 mb-4"><%= @level.instructions %></p>
        <div class="bg-blue-50 p-4 rounded text-sm text-blue-800">
          <strong><%= t('levels.show.goal') %>:</strong> <%= @level.description %>
        </div>
      </div>

      <!-- Editor -->
      <div class="flex-1 flex flex-col bg-gray-900 text-white relative">
        <div class="px-4 py-2 bg-gray-800 text-xs text-gray-400 uppercase tracking-wider flex justify-between items-center">
          <span><%= t('levels.show.html_editor') %></span>
          <button 
            data-action="live-preview#checkAnswer"
            class="bg-green-600 hover:bg-green-500 text-white px-3 py-1 rounded text-xs font-bold transition"
          >
            <%= t('levels.show.check_answer') %>
          </button>
        </div>
        <textarea 
          data-live-preview-target="editor"
          data-action="input->live-preview#updatePreview"
          data-solution="<%= @level.solution_code %>"
          data-level-id="<%= @level.id %>"
          class="flex-1 w-full h-full bg-gray-900 text-gray-100 p-4 font-mono text-sm focus:outline-none resize-none"
          spellcheck="false"
        ><%= @level.initial_code.gsub('\\n', "\n") %></textarea>
        
        <!-- Success Message Overlay -->
        <div data-live-preview-target="successMessage" class="hidden absolute inset-0 bg-gray-900/90 flex items-center justify-center z-10">
          <div class="text-center">
            <h3 class="text-2xl font-bold text-green-400 mb-2"><%= t('levels.show.success.title') %></h3>
            <p class="text-gray-300 mb-4"><%= t('levels.show.success.message') %></p>
            <% if @next_level %>
              <%= link_to t('levels.show.success.next_level'), level_path(@next_level), class: "inline-block bg-blue-600 hover:bg-blue-500 text-white px-6 py-2 rounded-lg font-semibold transition" %>
            <% else %>
              <%= link_to t('levels.show.success.back_home'), levels_path, class: "inline-block bg-gray-600 hover:bg-gray-500 text-white px-6 py-2 rounded-lg font-semibold transition" %>
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Panel: Live Preview -->
    <div class="w-1/2 flex flex-col bg-white">
      <div class="px-4 py-2 bg-gray-100 border-b border-gray-200 text-xs text-gray-500 uppercase tracking-wider flex justify-between items-center">
        <span><%= t('levels.show.live_preview') %></span>
        <span class="text-[10px] text-gray-400"><%= t('levels.show.powered_by') %></span>
      </div>
      
      <!-- Split Preview Area -->
      <div class="flex-1 flex flex-col">
        <!-- User's Result -->
        <div class="flex-1 flex flex-col border-b border-gray-200">
          <div class="px-3 py-1.5 bg-blue-50 border-b border-blue-100 text-xs text-blue-700 font-medium">
            당신의 결과
          </div>
          <iframe 
            data-live-preview-target="preview"
            class="flex-1 w-full h-full border-none"
            sandbox="allow-scripts"
          ></iframe>
        </div>
        
        <!-- Target Result -->
        <div class="flex-1 flex flex-col">
          <div class="px-3 py-1.5 bg-green-50 border-b border-green-100 text-xs text-green-700 font-medium">
            목표 결과
          </div>
          <iframe 
            data-live-preview-target="solutionPreview"
            class="flex-1 w-full h-full border-none"
            sandbox="allow-scripts"
          ></iframe>
        </div>
      </div>
    </div>
  </div>
</div>
